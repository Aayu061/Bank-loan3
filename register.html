<!doctype html>
<html lang="en" class="dark">
<head>
  <title>Nexa Bank — Register</title>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="api-base" content="https://nexa-bank.onrender.com">
  <link rel="icon" href="./N.png" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={darkMode:'class',theme:{extend:{colors:{brand:{DEFAULT:'#7c3aed',dark:'#6d28d9'},slatebg:'#0b1220'}}}}</script>
</head>
<body class="min-h-screen text-slate-100">
  <header class="nav-blur sticky top-0 z-50">
    <div class="container-max mx-auto px-4 h-14 flex items-center justify-between">
      <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition">
        <img src="./Nexa Bank.png" alt="Nexa Bank Logo" class="site-logo object-cover rounded" />
      </a>
    </div>
  </header>

  <main class="container-max mx-auto px-4 py-12">
    <div class="mb-6">
      <a href="login.html" class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 border border-white/10 transition font-semibold">← Back</a>
    </div>

    <div class="max-w-xl mx-auto relative glass rounded-2xl p-8 border border-white/10 shadow-soft animate-scale-in">
      <!-- decorative blob to match site style -->
      <div aria-hidden="true" class="hero-deco hidden md:block"></div>
    
      <h1 class="text-2xl font-bold mb-3">Create your Nexa Bank account</h1>
      <p class="text-slate-300 mb-6">Register with your email to start your loan journey. Secure, fast and paperless onboarding.</p>

      <form id="registerForm" class="space-y-4">
         <label class="block">
          <span class="text-sm">Customer name</span>
          <input id="customerName" type="text" placeholder="Your full name"
                 class="mt-1 w-full rounded-lg bg-slate-800 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-brand" />
        </label>

        <label class="block">
          <span class="text-sm">Mobile number</span>
          <input id="customerMobile" type="tel" placeholder="Mobile number"
                 class="mt-1 w-full rounded-lg bg-slate-800 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-brand" />
        </label>
        
        <label class="block">
          <span class="text-sm">Email address</span>
          <input id="regEmail" type="email" required placeholder="you@example.com" class="mt-1 w-full rounded-lg bg-slate-800 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-brand" />
        </label>

        <label class="block">
          <span class="text-sm">Password</span>
          <div class="relative">
            <input id="regPass" type="password" required placeholder="Create a password" class="mt-1 w-full rounded-lg bg-slate-800 border border-white/10 px-3 py-2 pr-12 outline-none focus:ring-2 focus:ring-brand" />
            <button id="regToggle1" type="button" class="pw-toggle absolute right-2 top-1/2 transform -translate-y-1/2" aria-label="Show password" aria-pressed="false"></button>
          </div>
          <div class="strength-wrap">
            <div class="strength-track"><div id="passStrengthBar" class="strength-bar" style="width:0%"></div></div>
            <div id="passStrengthText" class="strength-text">Use at least 8 characters, mix letters & numbers.</div>
          </div>
        </label>

        <label class="block">
          <span class="text-sm">Confirm Password</span>
          <div class="relative">
            <input id="regPass2" type="password" required placeholder="Confirm password" class="mt-1 w-full rounded-lg bg-slate-800 border border-white/10 px-3 py-2 pr-12 outline-none focus:ring-2 focus:ring-brand" />
            <button id="regToggle2" type="button" class="pw-toggle absolute right-2 top-1/2 transform -translate-y-1/2" aria-label="Show password" aria-pressed="false"></button>
          </div>
          <div id="pwRulesWrap">
            <ul id="pwRules" class="validation-list">
              <li id="rule-length" class="invalid"><span class="dot">✕</span> At least 8 characters</li>
              <li id="rule-case" class="invalid"><span class="dot">✕</span> Uppercase and lowercase letters</li>
              <li id="rule-number" class="invalid"><span class="dot">✕</span> At least one number</li>
              <li id="rule-symbol" class="invalid"><span class="dot">✕</span> At least one symbol (e.g. !@#$%)</li>
            </ul>
            <div id="pwMatchText" class="pw-match invalid hidden"><span class="dot">✕</span><span id="pwMatchMsg">Passwords do not match</span></div>
          </div>
        </label>

        <label class="flex items-center gap-2 text-sm text-slate-300">
          <input id="agree" type="checkbox" class="rounded" />
          I agree to the <a href="#" class="text-brand underline">Terms & Privacy</a>
        </label>

        <button id="registerBtn" type="submit" class="w-full py-2.5 rounded-xl bg-gradient-to-r from-brand to-indigo-600 font-semibold" disabled>Register</button>
      </form>

      <p class="text-xs text-slate-400 mt-4">After registering you can apply for loans, check eligibility and track application status.</p>
    </div>
  </main>

  <footer class="container-max mx-auto px-4 py-8 text-xs text-slate-400">© Nexa Bank — Next-step finance.</footer>

  <script src="./UI.nomodule.js"></script>
  <!-- Success dialog markup -->
  <div id="successDialogOverlay" class="success-dialog-overlay hidden" aria-hidden="true">
    <div class="success-dialog">
      <div class="icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5" stroke="#34d399"/></svg>
      </div>
      <h3 class="success-title">Success</h3>
      <p class="success-sub">Registration complete.</p>
      <div class="actions">
        <button class="btn bg-brand text-white" onclick="document.getElementById('successDialogOverlay').classList.remove('open')">Continue</button>
      </div>
    </div>
  </div>
  <script>
    if(window.wireMobileNav) wireMobileNav('mobileMenuBtn','mobileMenu');
    // wire toggles for register fields
    if(window.wirePasswordToggle) wirePasswordToggle('regPass','regToggle1');
    if(window.wirePasswordToggle) wirePasswordToggle('regPass2','regToggle2');

    const strengthBar = document.getElementById('passStrengthBar');
    const strengthText = document.getElementById('passStrengthText');
    const passInput = document.getElementById('regPass');
    const pass2Input = document.getElementById('regPass2');
    const passMatchText = document.getElementById('pwMatchText');

    function scorePassword(p){
      let score = 0;
      if(!p) return 0;
      if(p.length >= 8) score += 1;
      if(/[a-z]/.test(p) && /[A-Z]/.test(p)) score += 1;
      if(/[0-9]/.test(p)) score += 1;
      if(/[^A-Za-z0-9]/.test(p)) score += 1;
      return score; // 0-4
    }

    function updateStrength(){
      const p = passInput.value.trim();
      const s = scorePassword(p);
      const pct = (s/4)*100;
      strengthBar.style.width = pct + '%';
      if(s <= 1){ strengthBar.style.backgroundColor = '#ef4444'; strengthText.textContent = 'Weak — add more characters and variety.'; }
      else if(s === 2){ strengthBar.style.backgroundColor = '#f59e0b'; strengthText.textContent = 'Fair — add uppercase or symbols for better security.'; }
      else if(s === 3){ strengthBar.style.backgroundColor = '#60a5fa'; strengthText.textContent = 'Good — consider adding symbols for extra strength.'; }
      else { strengthBar.style.backgroundColor = '#34d399'; strengthText.textContent = 'Strong — nice! Your password is secure.'; }

      // Update rule list
      const rLen = document.getElementById('rule-length');
      const rCase = document.getElementById('rule-case');
      const rNum = document.getElementById('rule-number');
      const rSym = document.getElementById('rule-symbol');
      const pass = p;
      const okLen = pass.length >= 8;
      const okCase = /[a-z]/.test(pass) && /[A-Z]/.test(pass);
      const okNum = /[0-9]/.test(pass);
      const okSym = /[^A-Za-z0-9]/.test(pass);
      setRuleState(rLen, okLen);
      setRuleState(rCase, okCase);
      setRuleState(rNum, okNum);
      setRuleState(rSym, okSym);
      updateFormValidity();
    }

    function setRuleState(node, ok){
      if(!node) return;
      const dot = node.querySelector('.dot');
      if(ok){ node.classList.remove('invalid'); node.classList.add('valid'); if(dot) dot.textContent = '✓'; }
      else { node.classList.remove('valid'); node.classList.add('invalid'); if(dot) dot.textContent = '✕'; }
    }

    passInput.addEventListener('input', ()=>{
      updateStrength();
      const a = passInput.value.trim();
      const b = pass2Input.value.trim();
      if(b === '') {
        passMatchText.classList.add('hidden');
      } else {
        const match = a === b;
        passMatchText.classList.toggle('hidden', match);
        setMatchState(match);
      }
    });

    pass2Input.addEventListener('input', ()=>{
      const a = passInput.value.trim();
      const b = pass2Input.value.trim();
      if(b === '') { passMatchText.classList.add('hidden'); setMatchState(false); }
      else { const match = a === b; passMatchText.classList.toggle('hidden', match); setMatchState(match); }
      updateFormValidity();
    });

    function setMatchState(match){
      const el = document.getElementById('pwMatchText');
      if(!el) return;
      if(match){ el.classList.remove('invalid'); el.classList.add('valid'); el.classList.remove('hidden'); el.querySelector('.dot').textContent = '✓'; el.querySelector('#pwMatchMsg').textContent = 'Passwords match'; }
      else { el.classList.remove('valid'); el.classList.add('invalid'); el.classList.remove('hidden'); el.querySelector('.dot').textContent = '✕'; el.querySelector('#pwMatchMsg').textContent = 'Passwords do not match'; }
    }

    function updateFormValidity(){
      const rLen = document.getElementById('rule-length').classList.contains('valid');
      const rCase = document.getElementById('rule-case').classList.contains('valid');
      const rNum = document.getElementById('rule-number').classList.contains('valid');
      const rSym = document.getElementById('rule-symbol').classList.contains('valid');
      const match = document.getElementById('pwMatchText') && document.getElementById('pwMatchText').classList.contains('valid');
      const email = document.getElementById('regEmail').value.trim() !== '';
      const agree = document.getElementById('agree').checked;
      const btn = document.getElementById('registerBtn');
      if(rLen && rCase && rNum && rSym && match && email && agree) btn.removeAttribute('disabled');
      else btn.setAttribute('disabled', '');
    }

    // re-check when email or agree toggles
    document.getElementById('regEmail').addEventListener('input', updateFormValidity);
    document.getElementById('agree').addEventListener('change', updateFormValidity);

    document.getElementById('registerForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('regEmail').value.trim();
      const p1 = passInput.value.trim();
      const p2 = pass2Input.value.trim();
      const agree = document.getElementById('agree').checked;
      if(!email || !p1 || !p2) { showToast('Please fill all fields'); return; }
      if(p1 !== p2) { showToast('Passwords do not match'); return; }
      if(!agree) { showToast('Please agree to Terms & Privacy'); return; }
      const firstName = (document.getElementById('customerName') && document.getElementById('customerName').value.trim()) || '';
      const phone = (document.getElementById('customerMobile') && document.getElementById('customerMobile').value.trim()) || null;
      try{
        await window.api.register({ first_name: firstName || 'User', last_name: '', email, password: p1, phone });
        if(window.showSuccessDialog) showSuccessDialog('Registration successful', 'Account created', 'login.html', 1400);
        else { showToast('Registration successful — logging you in', 2000); setTimeout(()=> location.href = 'login.html', 1100); }
      }catch(err){
        console.warn('registration failed', err);
        showToast(err.message || 'Registration failed', 3000);
      }
    });
  </script>
</body>
</html>